<!--pages/category/category.wxml-->
<view class="container">
  <!-- é¡¶éƒ¨æ ‡é¢˜ -->
  <!-- <view class="header" style="background: {{themeConfig.primary}};">
    <text class="header-title">å•†å“åˆ†ç±»</text>
  </view> -->

  <view class="category-wrapper">
    <!-- å·¦ä¾§åˆ†ç±»åˆ—è¡¨ -->
    <scroll-view class="category-list" scroll-y>
      <view
        wx:for="{{categories}}"
        wx:key="id"
        class="category-item {{currentCategoryId === item.id ? 'active' : ''}}"
        bindtap="onCategoryTap"
        data-id="{{item.id}}"
      >
        <text class="category-name" style="{{currentCategoryId === item.id ? 'color: ' + themeConfig.primary : ''}}">{{item.categoryName}}</text>
        <view wx:if="{{currentCategoryId === item.id}}" class="active-indicator" style="background: {{themeConfig.primary}};"></view>
      </view>
    </scroll-view>

    <!-- å³ä¾§å•†å“åˆ—è¡¨ -->
    <view class="product-wrapper">
      <!-- åˆ†ç±»æ ‡é¢˜å’Œæ’åº -->
      <view class="product-header">
        <text class="category-title">{{currentCategoryName}}</text>
        <view class="sort-selector" bindtap="showSortOptions">
          <text class="sort-text">{{sortText}}</text>
          <text class="sort-arrow">âˆ¨</text>
        </view>
      </view>

      <!-- å•†å“åˆ—è¡¨ -->
      <scroll-view class="product-list" scroll-y>
        <view
          wx:for="{{products}}"
          wx:key="id"
          class="product-card"
          bindtap="goToProductDetail"
          data-id="{{item.id}}"
        >
          <!-- å•†å“å›¾ç‰‡ -->
          <image class="product-img" src="{{item.mainImage}}" mode="aspectFill" lazy-load></image>

          <!-- å•†å“ä¿¡æ¯ -->
          <view class="product-content">
            <!-- å•†å“åç§° -->
            <text class="product-title">{{item.productName}}</text>

            <!-- è§„æ ¼æè¿° -->
            <text class="product-spec" wx:if="{{item.description}}">{{item.description}}</text>

            <!-- ä»·æ ¼è¡Œ -->
            <view class="price-line">
              <!-- VIPä¼šå‘˜æ˜¾ç¤ºVIPä»· -->
              <view wx:if="{{item.vipPrice && userInfo && userInfo.userType === 2}}" class="price-group">
                <text class="vip-price" style="color: {{themeConfig.primary}};">Â¥{{item.vipPrice}}</text>
                <text class="original-price">Â¥{{item.price}}</text>
                <view class="vip-tag" style="background: {{themeConfig.secondary}};">
                  <text class="vip-tag-text">VIP</text>
                </view>
              </view>
              <!-- æ™®é€šä¼šå‘˜æ˜¾ç¤ºåŸä»· -->
              <view wx:else class="price-group">
                <text class="product-price" style="color: {{themeConfig.primary}};">Â¥{{item.price}}</text>
              </view>
            </view>

            <!-- é”€é‡ -->
            <text class="sales-text">å·²å”® {{item.salesCount || 0}} ä»¶</text>
          </view>

          <!-- åŠ è´­ç‰©è½¦æŒ‰é’® -->
          <view class="add-cart-btn" catchtap="addToCart" data-id="{{item.id}}" data-name="{{item.productName}}" style="background: {{themeConfig.primary}};">
            <text class="btn-text">+</text>
          </view>
        </view>

        <!-- ç©ºçŠ¶æ€ -->
        <view wx:if="{{products.length === 0}}" class="empty-state">
          <text class="empty-icon">ğŸ“¦</text>
          <text class="empty-text">è¯¥åˆ†ç±»æš‚æ— å•†å“</text>
        </view>
      </scroll-view>
    </view>
  </view>
</view>
