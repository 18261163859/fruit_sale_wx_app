<!--pages/order-list/order-list.wxml-->
<view class="container">
  <!-- Tabæ  -->
  <view class="tabs">
    <view
      wx:for="{{tabs}}"
      wx:key="index"
      class="tab-item {{activeTab === index ? 'active' : ''}}"
      bindtap="switchTab"
      data-index="{{index}}"
    >
      <text class="tab-name">{{item.name}}</text>
    </view>
  </view>

  <!-- è®¢å•åˆ—è¡¨ -->
  <scroll-view class="order-list" scroll-y enable-back-to-top refresher-enabled refresher-triggered="{{loading}}" bindrefresherrefresh="onPullDownRefresh">
    <view wx:if="{{orders.length > 0}}">
      <view
        wx:for="{{orders}}"
        wx:key="id"
        class="order-card"
        bindtap="goToDetail"
        data-id="{{item.id}}"
      >
        <!-- è®¢å•å¤´éƒ¨ -->
        <view class="order-header">
          <view class="header-left">
            <text class="order-no">è®¢å•å·: {{item.orderNo}}</text>
            <text class="order-time">{{item.createTime}}</text>
          </view>
          <view class="order-status-tag {{item.statusClass}}">
            {{item.statusText}}
          </view>
        </view>

        <!-- å•†å“åˆ—è¡¨ -->
        <view class="products-section">
          <view
            wx:for="{{item.items}}"
            wx:for-item="product"
            wx:key="id"
            class="product-item"
          >
            <image class="product-image" src="{{product.productImage}}" mode="aspectFill" />
            <view class="product-info">
              <text class="product-name">{{product.productName}}</text>
              <text class="product-spec" wx:if="{{product.specName}}">{{product.specName}}</text>
              <view class="price-row">
                <text class="price">Â¥{{product.productPrice}}</text>
                <text class="quantity">x{{product.quantity}}</text>
              </view>
            </view>
          </view>
        </view>

        <!-- è®¢å•åº•éƒ¨ -->
        <view class="order-footer">
          <view class="footer-content">
            <view class="amount-section">
              <text class="items-count">å…±{{item.totalQuantity}}ä»¶å•†å“</text>
              <view class="amount-info">
                <text class="amount-label">å®ä»˜</text>
                <text class="amount-value">Â¥{{item.payAmount || item.actualAmount || item.totalAmount}}</text>
              </view>
            </view>

            <view class="action-buttons">
            <!-- å¾…ä»˜æ¬¾çŠ¶æ€ -->
            <block wx:if="{{item.orderStatus === 0}}">
              <button
                class="btn cancel-btn"
                catchtap="cancelOrder"
                data-id="{{item.id}}"
              >
                å–æ¶ˆè®¢å•
              </button>
              <button
                class="btn pay-btn"
                catchtap="payOrder"
                data-id="{{item.id}}"
              >
                å»æ”¯ä»˜
              </button>
            </block>

            <!-- å¾…å‘è´§çŠ¶æ€ -->
            <block wx:if="{{item.orderStatus === 1}}">
              <button class="btn detail-btn" catchtap="goToDetail" data-id="{{item.id}}">
                æŸ¥çœ‹è¯¦æƒ…
              </button>
            </block>

            <!-- å¾…æ”¶è´§çŠ¶æ€ -->
            <block wx:if="{{item.orderStatus === 2}}">
              <button
                class="btn confirm-btn"
                catchtap="confirmReceipt"
                data-id="{{item.id}}"
              >
                ç¡®è®¤æ”¶è´§
              </button>
            </block>

            <!-- å·²å®ŒæˆçŠ¶æ€ -->
            <block wx:if="{{item.orderStatus === 3}}">
              <button class="btn detail-btn" catchtap="goToDetail" data-id="{{item.id}}">
                æŸ¥çœ‹è¯¦æƒ…
              </button>
            </block>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view wx:else class="empty-state">
      <view class="empty-icon">ğŸ“¦</view>
      <text class="empty-text">æš‚æ— è®¢å•</text>
      <text class="empty-tip">å¿«å»é€‰è´­å¿ƒä»ªçš„æ°´æœå§~</text>
    </view>

    <!-- åŠ è½½çŠ¶æ€ -->
    <view wx:if="{{loading}}" class="loading-state">
      <text>åŠ è½½ä¸­...</text>
    </view>

    <!-- æ²¡æœ‰æ›´å¤š -->
    <view wx:if="{{!hasMore && orders.length > 0}}" class="no-more">
      <text>æ²¡æœ‰æ›´å¤šäº†</text>
    </view>
  </scroll-view>
</view>
