<!--pages/profile/profile.wxml-->
<view class="container">
  <!-- ç”¨æˆ·ä¿¡æ¯åŒºåŸŸ -->
  <view class="user-section">
    <view class="user-header" data-theme="{{currentTheme}}">
      <image wx:if="{{userInfo.avatarUrl}}" class="avatar" src="{{userInfo.avatarUrl}}" mode="aspectFill"></image>
      <view wx:else class="avatar-placeholder">
        <text class="avatar-icon">ğŸ‘¤</text>
      </view>

      <view class="user-info">
        <view class="user-name-row">
          <text class="nickname">{{userInfo.nickname || 'æœªç™»å½•'}}</text>

          <!-- ä¼šå‘˜å¾½ç« å’Œä»£ç†å¾½ç« å¯ä»¥åŒæ—¶æ˜¾ç¤º -->
          <!-- ä¼šå‘˜å¾½ç«  -->
          <view wx:if="{{isVip}}" class="type-badge vip-member">
            <text class="badge-text">æ˜Ÿäº«ä¼šå‘˜</text>
          </view>

          <!-- ä»£ç†å¾½ç«  -->
          <view wx:if="{{userInfo.agentLevel === 2}}" class="type-badge agent-level-2">
            <text class="badge-text">äºŒçº§ä»£ç†</text>
          </view>
          <view wx:elif="{{userInfo.agentLevel === 1}}" class="type-badge agent-level-1">
            <text class="badge-text">ä¸€çº§ä»£ç†</text>
          </view>

          <!-- å¦‚æœæ—¢ä¸æ˜¯ä¼šå‘˜ä¹Ÿä¸æ˜¯ä»£ç†ï¼Œæ˜¾ç¤ºæ™®é€šä¼šå‘˜ -->
          <view wx:if="{{!isVip && !userInfo.agentLevel}}" class="type-badge normal-member">
            <text class="badge-text">æ™®é€šä¼šå‘˜</text>
          </view>
        </view>
        <text class="phone">{{userInfo.phone || ''}}</text>
      </view>
    </view>

    <!-- ä¼šå‘˜ä¿¡æ¯å¡ç‰‡ -->
    <view wx:if="{{isVip}}" class="member-card vip-member">
      <view class="member-info">
        <text class="member-title">æ˜Ÿäº«ä¼šå‘˜</text>
      </view>
      <view class="member-benefits">
        <view class="benefit-item">
          <text class="benefit-value">95æŠ˜</text>
          <text class="benefit-label">ä¸“äº«æŠ˜æ‰£</text>
        </view>
        <view class="benefit-divider"></view>
        <view class="benefit-item">
          <text class="benefit-value">{{userInfo.integralBalance || 0}}</text>
          <text class="benefit-label">å¯ç”¨ç§¯åˆ†</text>
        </view>
      </view>
    </view>

    <!-- éä¼šå‘˜å¼€é€šå¡ç‰‡ -->
    <view wx:else class="member-card normal-user" bindtap="goToOpenVip">
      <view class="member-info">
        <text class="member-title">å¼€é€šæ˜Ÿäº«ä¼šå‘˜</text>
        <text class="member-desc">95æŠ˜ä¼˜æƒ  + ä¸“å±æœåŠ¡</text>
      </view>
      <view class="open-btn">
        <text>ç«‹å³å¼€é€š</text>
      </view>
    </view>
  </view>

  <!-- è®¢å•ç»Ÿè®¡ -->
  <view class="order-section">
    <view class="section-header">
      <text class="section-title">æˆ‘çš„è®¢å•</text>
      <view class="view-all" bindtap="goToOrders">
        <text>å…¨éƒ¨è®¢å•</text>
        <text class="arrow">></text>
      </view>
    </view>

    <view class="order-stats">
      <view class="stat-item" bindtap="goToOrdersByStatus" data-status="0">
        <view class="stat-icon-wrapper">
          <text class="stat-icon">ğŸ’³</text>
          <view wx:if="{{orderStats.pendingPaymentCount > 0}}" class="stat-badge">{{orderStats.pendingPaymentCount}}</view>
        </view>
        <text class="stat-label">å¾…ä»˜æ¬¾</text>
      </view>

      <view class="stat-item" bindtap="goToOrdersByStatus" data-status="1">
        <view class="stat-icon-wrapper">
          <text class="stat-icon">ğŸ“¦</text>
          <view wx:if="{{orderStats.pendingShipmentCount > 0}}" class="stat-badge">{{orderStats.pendingShipmentCount}}</view>
        </view>
        <text class="stat-label">å¾…å‘è´§</text>
      </view>

      <view class="stat-item" bindtap="goToOrdersByStatus" data-status="2">
        <view class="stat-icon-wrapper">
          <text class="stat-icon">ğŸšš</text>
          <view wx:if="{{orderStats.shippedCount > 0}}" class="stat-badge">{{orderStats.shippedCount}}</view>
        </view>
        <text class="stat-label">å¾…æ”¶è´§</text>
      </view>

      <!-- <view class="stat-item" bindtap="goToOrdersByStatus" data-status="3">
        <view class="stat-icon-wrapper">
          <text class="stat-icon">â­</text>
          <view wx:if="{{orderStats.pendingReviewCount > 0}}" class="stat-badge">{{orderStats.pendingReviewCount}}</view>
        </view>
        <text class="stat-label">å¾…è¯„ä»·</text>
      </view> -->
    </view>
  </view>

  <!-- ä»£ç†ä¿¡æ¯ -->
  <view wx:if="{{isAgent}}" class="agent-section">
    <view class="agent-card" bindtap="goToAgent">
      <view class="agent-header-row">
        <text class="agent-level-badge">{{userInfo.agentLevel === 1 ? 'ä¸€çº§ä»£ç†' : 'äºŒçº§ä»£ç†'}}</text>
        <text class="arrow-white">></text>
      </view>

      <view class="agent-stats-row">
        <view class="agent-stat-item">
          <text class="agent-stat-value">Â¥{{agentStats.totalCommission || '0.00'}}</text>
          <text class="agent-stat-label">ç´¯è®¡æ”¶ç›Š</text>
        </view>
        <view class="agent-stat-divider"></view>
        <view class="agent-stat-item">
          <text class="agent-stat-value">{{agentStats.subAgentCount || 0}}</text>
          <text class="agent-stat-label">ä¸‹çº§ä»£ç†</text>
        </view>
        <view class="agent-stat-divider"></view>
        <view class="agent-stat-item">
          <text class="agent-stat-value">{{agentStats.subMemberCount || 0}}</text>
          <text class="agent-stat-label">ä¸‹çº§ä¼šå‘˜</text>
        </view>
      </view>

      <view class="agent-action-hint">
        <text class="action-hint-text">æŸ¥çœ‹è¯¦ç»†æ•°æ®</text>
      </view>
    </view>
  </view>

  <!-- åŠŸèƒ½èœå• -->
  <view class="menu-section">
    <view class="menu-item" bindtap="goToAddresses">
      <view class="menu-left">
        <text class="menu-icon">ğŸ“</text>
        <text class="menu-title">æ”¶è´§åœ°å€</text>
      </view>
      <text class="arrow">></text>
    </view>

    <view class="menu-item" bindtap="goToIntegral">
      <view class="menu-left">
        <text class="menu-icon">ğŸ</text>
        <text class="menu-title">ç§¯åˆ†ä¸­å¿ƒ</text>
      </view>
      <view class="menu-right">
        <text class="menu-value">{{userInfo.integralBalance || 0}}</text>
        <text class="arrow">></text>
      </view>
    </view>

    <!-- ç»‘å®šé‚€è¯·ç å…¥å£ï¼ˆæœªç»‘å®šæ—¶æ˜¾ç¤ºï¼‰ -->
    <view wx:if="{{!userInfo.inviterUserId}}" class="menu-item" bindtap="showBindInviteCodeDialog">
      <view class="menu-left">
        <text class="menu-icon">ğŸ”—</text>
        <text class="menu-title">ç»‘å®šé‚€è¯·ç </text>
      </view>
      <view class="menu-right">
        <text class="menu-tip">æœªç»‘å®š</text>
        <text class="arrow">></text>
      </view>
    </view>

    <!-- å·²ç»‘å®šé‚€è¯·ç æ˜¾ç¤ºï¼ˆåªè¯»ï¼‰ -->
    <view wx:else class="menu-item">
      <view class="menu-left">
        <text class="menu-icon">âœ…</text>
        <text class="menu-title">é‚€è¯·äºº</text>
      </view>
      <view class="menu-right">
        <text class="menu-value bound">å·²ç»‘å®š</text>
      </view>
    </view>

    <!-- å‘è´§ç®¡ç†å…¥å£ï¼ˆä»…å‘è´§äººå‘˜å¯è§ï¼‰ -->
    <view wx:if="{{userInfo.isShipper === 1}}" class="menu-item" bindtap="goToShipping">
      <view class="menu-left">
        <text class="menu-icon">ğŸ“¦</text>
        <text class="menu-title">å‘è´§ç®¡ç†</text>
      </view>
      <text class="arrow">></text>
    </view>

    <view class="menu-item" bindtap="goToCustomerService">
      <view class="menu-left">
        <text class="menu-icon">ğŸ’¬</text>
        <text class="menu-title">è”ç³»å®¢æœ</text>
      </view>
      <text class="arrow">></text>
    </view>

    <view class="menu-item" bindtap="goToSettings">
      <view class="menu-left">
        <text class="menu-icon">âš™ï¸</text>
        <text class="menu-title">è®¾ç½®</text>
      </view>
      <text class="arrow">></text>
    </view>

    <view class="menu-item logout-item" bindtap="onLogout">
      <view class="menu-left">
        <text class="menu-icon">ğŸšª</text>
        <text class="menu-title">é€€å‡ºç™»å½•</text>
      </view>
    </view>
  </view>
</view>

<!-- ç»‘å®šé‚€è¯·ç å¼¹çª— -->
<view wx:if="{{showInviteCodeDialog}}" class="dialog-overlay" bindtap="hideBindInviteCodeDialog">
  <view class="dialog-container" catchtap="preventClose">
    <view class="dialog-header">
      <text class="dialog-title">ç»‘å®šé‚€è¯·ç </text>
      <text class="dialog-close" bindtap="hideBindInviteCodeDialog">Ã—</text>
    </view>
    <view class="dialog-content">
      <view class="dialog-tip">ç»‘å®šåä¸å¯ä¿®æ”¹ï¼Œè¯·è°¨æ…å¡«å†™</view>
      <input class="invite-code-input" type="text" placeholder="è¯·è¾“å…¥é‚€è¯·ç " value="{{inputInviteCode}}" bindinput="onInviteCodeInput" maxlength="20" />
    </view>
    <view class="dialog-footer">
      <button class="dialog-btn cancel-btn" bindtap="hideBindInviteCodeDialog">å–æ¶ˆ</button>
      <button class="dialog-btn confirm-btn" bindtap="confirmBindInviteCode">ç¡®è®¤ç»‘å®š</button>
    </view>
  </view>
</view>
