<!--pages/search/search.wxml-->
<view class="container">
  <!-- 搜索框 -->
  <view class="search-box">
    <view class="search-input-wrapper">
      <icon class="search-icon" type="search" size="16" color="#999"></icon>
      <input
        class="search-input"
        type="text"
        placeholder="搜索高端水果"
        value="{{keyword}}"
        bindinput="onInput"
        bindconfirm="onSearchBtn"
        focus="{{!keyword}}"
      />
      <icon
        wx:if="{{keyword}}"
        class="clear-icon"
        type="clear"
        size="16"
        color="#999"
        bindtap="onClearInput"
      ></icon>
    </view>
    <text class="search-btn" bindtap="onSearchBtn">搜索</text>
  </view>

  <!-- 搜索建议区域 -->
  <view wx:if="{{!showResult}}" class="suggestions">
    <!-- 搜索历史 -->
    <view wx:if="{{searchHistory.length > 0}}" class="history-section">
      <view class="section-header">
        <text class="section-title">搜索历史</text>
        <text class="clear-btn" bindtap="clearHistory">清空</text>
      </view>
      <view class="tag-list">
        <text
          wx:for="{{searchHistory}}"
          wx:key="index"
          class="tag"
          bindtap="onKeywordTap"
          data-keyword="{{item}}"
        >
          {{item}}
        </text>
      </view>
    </view>

    <!-- 热门搜索 -->
    <view class="hot-section">
      <view class="section-header">
        <text class="section-title">🔥 热门搜索</text>
      </view>
      <view class="tag-list">
        <text
          wx:for="{{hotKeywords}}"
          wx:key="index"
          class="tag hot-tag"
          bindtap="onKeywordTap"
          data-keyword="{{item}}"
        >
          {{item}}
        </text>
      </view>
    </view>
  </view>

  <!-- 搜索结果 -->
  <view wx:if="{{showResult}}" class="search-result">
    <!-- 结果统计 -->
    <view class="result-header">
      <text class="result-count">找到 {{total}} 件商品</text>
    </view>

    <!-- 商品列表 -->
    <view class="product-list" wx:if="{{products.length > 0}}">
      <view
        class="product-item"
        wx:for="{{products}}"
        wx:key="id"
        bindtap="goToProductDetail"
        data-id="{{item.id}}"
      >
        <image class="product-image" src="{{item.coverImage}}" mode="aspectFill" lazy-load></image>

        <view class="product-info">
          <text class="product-name">{{item.productName}}</text>

          <view class="product-footer">
            <view class="price-wrapper">
              <!-- VIP会员显示VIP价 -->
              <view wx:if="{{item.vipPrice && userInfo && userInfo.userType === 2}}" class="price-group">
                <text class="vip-price">{{item.vipPrice}}</text>
                <text class="original-price">¥{{item.price}}</text>
              </view>
              <!-- 普通会员显示原价 -->
              <view wx:else class="price-group">
                <text class="product-price">{{item.price}}</text>
              </view>
            </view>

            <view class="product-sales">已售{{item.salesCount}}件</view>
          </view>

          <view
            class="add-cart-btn"
            catchtap="addToCart"
            data-id="{{item.id}}"
            data-name="{{item.productName}}"
          >
            <text class="add-icon">+</text>
          </view>
        </view>
      </view>
    </view>

    <!-- 加载状态 -->
    <view wx:if="{{loading}}" class="loading-wrapper">
      <text class="loading-text">加载中...</text>
    </view>

    <!-- 空状态 -->
    <view wx:if="{{products.length === 0 && !loading}}" class="empty-state">
      <image class="empty-image" src="/images/empty-search.png" mode="aspectFit"></image>
      <text class="empty-text">暂无相关商品</text>
      <text class="empty-tip">换个关键词试试吧</text>
    </view>

    <!-- 加载更多提示 -->
    <view wx:if="{{!hasMore && products.length > 0}}" class="no-more">
      没有更多了
    </view>
  </view>
</view>
