<!--pages/checkout/checkout.wxml-->
<view class="container">
  <!-- æ”¶è´§åœ°å€ -->
  <view class="address-section" bindtap="selectAddress">
    <view wx:if="{{selectedAddress}}" class="address-content">
      <view class="address-icon">ğŸ“</view>
      <view class="address-info">
        <view class="receiver-row">
          <text class="receiver-name">{{selectedAddress.receiverName}}</text>
          <text class="receiver-phone">{{selectedAddress.receiverPhone}}</text>
        </view>
        <view class="address-detail">
          {{selectedAddress.province}} {{selectedAddress.city}} {{selectedAddress.district}} {{selectedAddress.detailAddress}}
        </view>
      </view>
      <view class="arrow-icon">â€º</view>
    </view>

    <view wx:else class="no-address" bindtap="addAddress">
      <view class="no-address-icon">+</view>
      <text class="no-address-text">æ·»åŠ æ”¶è´§åœ°å€</text>
    </view>
  </view>

  <!-- å•†å“åˆ—è¡¨ -->
  <view class="products-section">
    <view class="section-title">å•†å“æ¸…å•</view>
    <view class="products-list">
      <view
        wx:for="{{products}}"
        wx:key="productId"
        class="product-item"
      >
        <image class="product-image" src="{{item.productImage}}" mode="aspectFill" />
        <view class="product-info">
          <text class="product-name">{{item.productName}}</text>
          <text class="product-spec" wx:if="{{item.specName}}">{{item.specName}}</text>
          <view class="price-quantity-row">
            <view class="price-group">
              <text class="price">Â¥{{item.price}}</text>
              <text wx:if="{{item.originalPrice > item.price}}" class="original-price">Â¥{{item.originalPrice}}</text>
            </view>
            <text class="quantity">x{{item.quantity}}</text>
          </view>
          <view wx:if="{{item.stock < 10}}" class="stock-tip">ä»…å‰©{{item.stock}}ä»¶</view>
        </view>
      </view>
    </view>
  </view>

  <!-- ç§¯åˆ†æŠµæ‰£ -->
  <view class="integral-section">
    <view class="integral-row">
      <text class="label">ä½¿ç”¨ç§¯åˆ†</text>
      <view class="integral-input-wrapper">
        <input
          class="integral-input"
          type="number"
          placeholder="0"
          value="{{useIntegral}}"
          bindinput="onIntegralInput"
        />
        <text class="integral-unit">ç§¯åˆ†</text>
        <text class="use-all-btn" bindtap="useAllIntegral">å…¨éƒ¨æŠµæ‰£</text>
      </view>
    </view>
    <view class="integral-tip">
      <text>å¯ç”¨ç§¯åˆ†: {{userIntegral}} | æœ€å¤šæŠµæ‰£: {{maxIntegralDeduct}} (Â¥{{maxDeductAmountText}})</text>
    </view>
  </view>

  <!-- è®¢å•å¤‡æ³¨ -->
  <view class="remark-section">
    <view class="remark-label">è®¢å•å¤‡æ³¨</view>
    <textarea
      class="remark-input"
      placeholder="é€‰å¡«ï¼Œå¦‚éœ€è¦ç‰¹åˆ«è¯´æ˜è¯·åœ¨æ­¤å¡«å†™"
      maxlength="200"
      value="{{remark}}"
      bindinput="onRemarkInput"
    />
  </view>

  <!-- ä»·æ ¼æ˜ç»† -->
  <view class="price-section">
    <view class="price-row">
      <text class="label">å•†å“æ€»é¢</text>
      <text class="value">Â¥{{originalAmount}}</text>
    </view>
    <view wx:if="{{savedAmount > 0}}" class="price-row">
      <text class="label">VIPä¼˜æƒ </text>
      <text class="value saved">-Â¥{{savedAmount}}</text>
    </view>
    <view wx:if="{{integralDeductAmount > 0}}" class="price-row">
      <text class="label">ç§¯åˆ†æŠµæ‰£</text>
      <text class="value deduct">-Â¥{{integralDeductAmount}}</text>
    </view>
    <view class="price-row">
      <text class="label">è¿è´¹</text>
      <text wx:if="{{freightAmount > 0}}" class="value">Â¥{{freightAmount}}</text>
      <text wx:else class="value free">å…è¿è´¹</text>
    </view>
    <view wx:if="{{totalAmount < freeFreightThreshold}}" class="freight-tip">
      <text>å†ä¹° Â¥{{remainingForFreeShipping}} å³å¯åŒ…é‚®</text>
    </view>
    <view class="price-row total">
      <text class="label">å®ä»˜é‡‘é¢</text>
      <text class="value amount">Â¥{{actualAmount}}</text>
    </view>
  </view>

  <!-- åº•éƒ¨æäº¤æŒ‰é’® -->
  <view class="footer-bar">
    <view class="total-info">
      <view class="total-label-group">
        <text class="total-label">åˆè®¡:</text>
        <text wx:if="{{savedAmount > 0 || integralDeductAmount > 0}}" class="original-total">Â¥{{originalAmount}}</text>
      </view>
      <text class="total-amount">Â¥{{actualAmount}}</text>
    </view>
    <button
      class="submit-btn"
      bindtap="submitOrder"
      disabled="{{loading}}"
    >
      {{loading ? 'æäº¤ä¸­...' : 'æäº¤è®¢å•'}}
    </button>
  </view>
</view>
