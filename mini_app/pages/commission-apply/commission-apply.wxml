<!--pages/commission-apply/commission-apply.wxml-->
<view class="container">
  <!-- 页面标题和操作按钮 -->
  <view class="header">
    <view class="header-title">
      <text class="title-text">返现申请</text>
      <text class="title-desc">提交返现申请，等待审核后发放</text>
    </view>
    <button class="apply-btn" bindtap="showApplyDialog">
      <text class="apply-icon">+</text>
      <text>发起申请</text>
    </button>
  </view>

  <!-- 可用余额卡片 -->
  <view class="balance-card">
    <view class="balance-item">
      <text class="balance-label">累计收益</text>
      <text class="balance-value">¥{{statistics.totalCommission}}</text>
    </view>
    <view class="balance-divider"></view>
    <view class="balance-item">
      <text class="balance-label">可申请余额</text>
      <text class="balance-value highlight">¥{{statistics.availableAmount}}</text>
    </view>
  </view>

  <!-- 申请列表 -->
  <view class="application-list">
    <block wx:if="{{applications.length > 0}}">
      <view class="application-item" wx:for="{{applications}}" wx:key="id">
        <view class="item-header">
          <view class="amount-section">
            <text class="amount-label">申请金额</text>
            <text class="amount-value">¥{{item.commissionAmount}}</text>
          </view>
          <view class="status-badge status-{{item.statusClass}}">
            {{item.statusText}}
          </view>
        </view>

        <view class="item-details">
          <view class="detail-row">
            <text class="detail-label">银行名称：</text>
            <text class="detail-value">{{item.bankName}}</text>
          </view>
          <view class="detail-row">
            <text class="detail-label">银行账号：</text>
            <text class="detail-value">{{item.bankAccount}}</text>
          </view>
          <view class="detail-row">
            <text class="detail-label">账户名：</text>
            <text class="detail-value">{{item.accountName}}</text>
          </view>
          <view class="detail-row" wx:if="{{item.remark}}">
            <text class="detail-label">备注：</text>
            <text class="detail-value">{{item.remark}}</text>
          </view>
        </view>

        <view class="item-footer">
          <view class="footer-item">
            <text class="footer-label">申请时间</text>
            <text class="footer-value">{{item.createTime}}</text>
          </view>
          <view class="footer-item" wx:if="{{item.reviewTime}}">
            <text class="footer-label">审核时间</text>
            <text class="footer-value">{{item.reviewTime}}</text>
          </view>
        </view>

        <view class="reject-reason" wx:if="{{item.status === 2 && item.rejectReason}}">
          <text class="reason-label">拒绝原因：</text>
          <text class="reason-text">{{item.rejectReason}}</text>
        </view>
      </view>
    </block>

    <view class="empty-state" wx:else>
      <view class="empty-icon-wrap">
        <text class="empty-icon-text">空</text>
      </view>
      <text class="empty-text">暂无返现申请</text>
      <text class="empty-tip">点击上方"发起申请"提交返现申请</text>
    </view>
  </view>

  <!-- 申请弹窗 -->
  <view class="apply-modal" wx:if="{{showApplyModal}}">
    <view class="modal-mask" bindtap="hideApplyDialog"></view>
    <view class="modal-content">
      <view class="modal-header">
        <text class="modal-title">提交返现申请</text>
        <text class="modal-close" bindtap="hideApplyDialog">✕</text>
      </view>
      <view class="modal-body">
        <view class="balance-tip">
          <text class="tip-label">可申请余额：</text>
          <text class="tip-value">¥{{statistics.availableAmount}}</text>
        </view>
        <view class="form-item">
          <text class="form-label">申请金额(元)</text>
          <input
            class="form-input"
            type="digit"
            placeholder="请输入申请金额"
            value="{{commissionAmount}}"
            bindinput="onAmountInput"
          />
        </view>
        <view class="form-item">
          <text class="form-label">银行名称</text>
          <input
            class="form-input"
            type="text"
            placeholder="例如：中国工商银行"
            value="{{bankName}}"
            bindinput="onBankNameInput"
          />
        </view>
        <view class="form-item">
          <text class="form-label">银行账号</text>
          <input
            class="form-input"
            type="text"
            placeholder="请输入银行账号"
            value="{{bankAccount}}"
            bindinput="onBankAccountInput"
          />
        </view>
        <view class="form-item">
          <text class="form-label">账户名</text>
          <input
            class="form-input"
            type="text"
            placeholder="请输入账户名"
            value="{{accountName}}"
            bindinput="onAccountNameInput"
          />
        </view>
        <view class="form-item">
          <text class="form-label">备注（选填）</text>
          <textarea
            class="form-textarea"
            placeholder="请输入备注"
            value="{{remark}}"
            bindinput="onRemarkInput"
            maxlength="200"
          />
        </view>
        <view class="form-tips">
          <text>提示：请确保银行信息准确无误，审核通过后将打款至该账户</text>
        </view>
      </view>
      <view class="modal-footer">
        <button class="cancel-btn" bindtap="hideApplyDialog">取消</button>
        <button class="confirm-btn" bindtap="submitApplication">提交申请</button>
      </view>
    </view>
  </view>
</view>
