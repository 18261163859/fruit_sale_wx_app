<!--pages/index/index.wxml-->
<view class="container" style="background-color: {{themeConfig.background}}">
  <!-- æœç´¢æ  -->
  <view class="search-bar" style="background-color: {{themeConfig.primary}}">
    <view class="search-input" bindtap="goToSearch">
      <icon class="search-icon" type="search" size="16" color="#999"></icon>
      <text class="search-placeholder">æœç´¢é«˜ç«¯æ°´æœ</text>
    </view>
  </view>

  <!-- è½®æ’­å›¾ -->
  <swiper
    class="banner-swiper"
    indicator-dots="{{true}}"
    autoplay="{{false}}"
    interval="3000"
    duration="500"
    circular="{{true}}"
    indicator-color="rgba(255,255,255,0.5)"
    indicator-active-color="{{themeConfig.primary}}"
    bindchange="onBannerChange"
    current="{{currentBannerIndex}}"
  >
    <swiper-item wx:for="{{banners}}" wx:key="id" bindtap="onBannerTap" data-index="{{index}}">
      <!-- å›¾ç‰‡è½®æ’­ -->
      <image wx:if="{{item.bannerType === 1 || !item.bannerType}}" class="banner-image" src="{{item.imageUrl}}" mode="aspectFill" lazy-load></image>

      <!-- è§†é¢‘è½®æ’­ -->
      <video
        wx:if="{{item.bannerType === 2}}"
        id="banner-video-{{index}}"
        class="banner-video"
        src="{{item.videoUrl}}"
        poster="{{item.imageUrl}}"
        object-fit="cover"
        autoplay="{{currentBannerIndex === index}}"
        loop="{{false}}"
        show-center-play-btn="{{false}}"
        show-play-btn="{{false}}"
        show-fullscreen-btn="{{false}}"
        muted="{{true}}"
        bindended="onVideoEnded"
        data-index="{{index}}"
      ></video>

      <view wx:if="{{item.title}}" class="banner-title">{{item.title}}</view>
    </swiper-item>
  </swiper>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{loading}}" class="loading-wrapper">
    <view class="loading-text">åŠ è½½ä¸­...</view>
  </view>

  <!-- æ¨èå•†å“ -->
  <view class="section" wx:if="{{!loading}}">
    <view class="section-header">
      <view class="section-title">
        <text class="title-icon">ğŸ”¥</text>
        <text class="title-text" style="color: {{themeConfig.textPrimary}}">ç²¾é€‰æ¨è</text>
      </view>
      <view class="section-more" bindtap="goToCategory">
        <text class="more-text">æŸ¥çœ‹æ›´å¤š</text>
        <text class="more-arrow">â€º</text>
      </view>
    </view>

    <!-- å•†å“åˆ—è¡¨ -->
    <view class="product-list" wx:if="{{products.length > 0}}">
      <view
        class="product-item {{currentTheme}}-item"
        wx:for="{{products}}"
        wx:key="id"
        bindtap="goToProductDetail"
        data-id="{{item.id}}"
        style="background-color: {{themeConfig.cardBg}}"
      >
        <image class="product-image" src="{{item.coverImage}}" mode="aspectFill" lazy-load></image>

        <!-- VIPæ ‡ç­¾ -->
        <view class="vip-badge" wx:if="{{item.vipPrice && userInfo && userInfo.userType === 2}}" style="background-color: {{themeConfig.secondary}}">
          <text class="vip-badge-text">VIP</text>
        </view>

        <view class="product-info">
          <text class="product-name" style="color: {{themeConfig.textPrimary}}">{{item.productName || item.name}}</text>

          <!-- ä»·æ ¼åŒºåŸŸ -->
          <view class="product-price-wrapper">
            <!-- VIPä¼šå‘˜æ˜¾ç¤ºVIPä»· -->
            <view wx:if="{{item.vipPrice && userInfo && userInfo.userType === 2}}" class="price-group">
              <text class="vip-price" style="color: {{themeConfig.primary}}">Â¥{{item.vipPrice}}</text>
              <text class="original-price">Â¥{{item.price}}</text>
            </view>
            <!-- æ™®é€šä¼šå‘˜æ˜¾ç¤ºåŸä»· -->
            <view wx:else class="price-group">
              <text class="product-price" style="color: {{themeConfig.primary}}">Â¥{{item.price}}</text>
            </view>
          </view>

          <view class="product-footer">
            <text class="product-sales">å·²å”®{{item.salesCount || 0}}ä»¶</text>
            <view class="add-cart-btn" catchtap="addToCart" data-id="{{item.id}}" data-name="{{item.productName || item.name}}" style="background-color: {{themeConfig.primary}}">
              <text class="add-icon">+</text>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:if="{{products.length === 0 && !loading}}">
      <image class="empty-image" src="/images/empty-product.png" mode="aspectFit"></image>
      <text class="empty-text">æš‚æ— å•†å“</text>
    </view>
  </view>
</view>